%% For double-blind review submission, w/o CCS and ACM Reference (max submission space)
\documentclass[sigplan,review,anonymous]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For double-blind review submission, w/ CCS and ACM Reference
%\documentclass[sigplan,review,anonymous]{acmart}\settopmatter{printfolios=true}
%% For single-blind review submission, w/o CCS and ACM Reference (max submission space)
%\documentclass[sigplan,review]{acmart}\settopmatter{printfolios=true,printccs=false,printacmref=false}
%% For single-blind review submission, w/ CCS and ACM Reference
%\documentclass[sigplan,review]{acmart}\settopmatter{printfolios=true}
%% For final camera-ready submission, w/ required CCS and ACM Reference
%\documentclass[sigplan]{acmart}\settopmatter{}


%% Conference information
%% Supplied to authors by publisher for camera-ready submission;
%% use defaults for review submission.
\acmConference[PL'18]{ACM SIGPLAN Conference on Programming Languages}{January 01--03, 2018}{New York, NY, USA}
\acmYear{2018}
\acmISBN{} % \acmISBN{978-x-xxxx-xxxx-x/YY/MM}
\acmDOI{} % \acmDOI{10.1145/nnnnnnn.nnnnnnn}
\startPage{1}

%% Copyright information
%% Supplied to authors (based on authors' rights management selection;
%% see authors.acm.org) by publisher for camera-ready submission;
%% use 'none' for review submission.
\setcopyright{none}
%\setcopyright{acmcopyright}
%\setcopyright{acmlicensed}
%\setcopyright{rightsretained}
%\copyrightyear{2018}           %% If different from \acmYear

%% Bibliography style
\bibliographystyle{ACM-Reference-Format}
%% Citation style
%\citestyle{acmauthoryear}  %% For author/year citations
%\citestyle{acmnumeric}     %% For numeric citations
%\setcitestyle{nosort}      %% With 'acmnumeric', to disable automatic
                            %% sorting of references within a single citation;
                            %% e.g., \cite{Smith99,Carpenter05,Baker12}
                            %% rendered as [14,5,2] rather than [2,5,14].
%\setcitesyle{nocompress}   %% With 'acmnumeric', to disable automatic
                            %% compression of sequential references within a
                            %% single citation;
                            %% e.g., \cite{Baker12,Baker14,Baker16}
                            %% rendered as [2,3,4] rather than [2-4].


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Note: Authors migrating a paper from traditional SIGPLAN
%% proceedings format to PACMPL format must update the
%% '\documentclass' and topmatter commands above; see
%% 'acmart-pacmpl-template.tex'.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Some recommended packages.
\usepackage{booktabs}   %% For formal tables:
                        %% http://ctan.org/pkg/booktabs
\usepackage{subcaption} %% For complex figures with subfigures/subcaptions
                        %% http://ctan.org/pkg/subcaption

\usepackage{csquotes}

\newcommand{\citeTodo}{[\textcolor{red}{\bfseries?}]}

\usepackage{enumitem}

\newcommand{\name}{Wasabi}

\hyphenation{Web-As-sem-bly}

\usepackage{cleveref}

\begin{document}

%% Title information
\title{\name: WebAssembly\\Analysis and Binary Instrumentation}         %% [Short Title] is optional;
                                        %% when present, will be used in
                                        %% header instead of Full Title.
%\titlenote{with title note}             %% \titlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'
%\subtitle{Powerful, Robust, Easy -- Pick Three.}                     %% \subtitle is optional
%\subtitlenote{with subtitle note}       %% \subtitlenote is optional;
                                        %% can be repeated if necessary;
                                        %% contents suppressed with 'anonymous'


%% Author information
%% Contents and number of authors suppressed with 'anonymous'.
%% Each author should be introduced by \author, followed by
%% \authornote (optional), \orcid (optional), \affiliation, and
%% \email.
%% An author may have multiple affiliations and/or emails; repeat the
%% appropriate command.
%% Many elements are not rendered, but should be provided for metadata
%% extraction tools.

%% Author with single affiliation.
\author{First1 Last1}
\authornote{with author1 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position1}
  \department{Department1}              %% \department is recommended
  \institution{Institution1}            %% \institution is required
  \streetaddress{Street1 Address1}
  \city{City1}
  \state{State1}
  \postcode{Post-Code1}
  \country{Country1}                    %% \country is recommended
}
\email{first1.last1@inst1.edu}          %% \email is recommended

%% Author with two affiliations and emails.
\author{First2 Last2}
\authornote{with author2 note}          %% \authornote is optional;
                                        %% can be repeated if necessary
\orcid{nnnn-nnnn-nnnn-nnnn}             %% \orcid is optional
\affiliation{
  \position{Position2a}
  \department{Department2a}             %% \department is recommended
  \institution{Institution2a}           %% \institution is required
  \streetaddress{Street2a Address2a}
  \city{City2a}
  \state{State2a}
  \postcode{Post-Code2a}
  \country{Country2a}                   %% \country is recommended
}
\email{first2.last2@inst2a.com}         %% \email is recommended
\affiliation{
  \position{Position2b}
  \department{Department2b}             %% \department is recommended
  \institution{Institution2b}           %% \institution is required
  \streetaddress{Street3b Address2b}
  \city{City2b}
  \state{State2b}
  \postcode{Post-Code2b}
  \country{Country2b}                   %% \country is recommended
}
\email{first2.last2@inst2b.org}         %% \email is recommended


%% Abstract
%% Note: \begin{abstract}...\end{abstract} environment must come
%% before \maketitle command
\begin{abstract}
\vspace*{9.8cm}
\end{abstract}


%% 2012 ACM Computing Classification System (CSS) concepts
%% Generate at 'http://dl.acm.org/ccs/ccs.cfm'.
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10011007.10011006.10011008</concept_id>
<concept_desc>Software and its engineering~General programming languages</concept_desc>
<concept_significance>500</concept_significance>
</concept>
<concept>
<concept_id>10003456.10003457.10003521.10003525</concept_id>
<concept_desc>Social and professional topics~History of programming languages</concept_desc>
<concept_significance>300</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~General programming languages}
\ccsdesc[300]{Social and professional topics~History of programming languages}
%% End of generated code


%% Keywords
%% comma separated list
\keywords{WebAssembly, dynamic analysis, binary instrumentation}  %% \keywords are mandatory in final camera-ready submission


%% \maketitle
%% Note: \maketitle command must come after title commands, author
%% commands, abstract environment, Computing Classification System
%% environment and commands, and keywords command.
\maketitle


\section{Introduction}

%% Context: Set the stage, relate to reader's situation

% Wasm is new and is here to stay
Until last year, the only widely supported programming language for the Web was JavaScript. With \emph{WebAssembly} (or \emph{Wasm} for short)~\cite{Haas:2017:BWU:3062341.3062363, WasmWebsite} reaching cross-browser consensus~\cite{WasmConsensus}, developers finally have a fast, yet safe and portable alternative for client-side execution. Wasm is also available in Node.js~\cite{NodejsWebsite}, a widely used server-side runtime, and is being considered for the next version of the Ethereum distributed virtual machine~\cite{EthereumWasm}. With all of these uses, WebAssembly will be a ubiquitous and highly important virtual instruction set for years to come.

% Wasm unique points and implications why dynamic analysis is important
The central properties of WebAssembly are as much reason for its attractiveness as they are challenges for users: 
\begin{enumerate}[leftmargin=\parindent]
	\item WebAssembly is a binary instruction format, which makes it compact (thus, quick to send over the network) and fast to decode (unlike JavaScript, where parsing can be a major bottleneck~\citeTodo). Unfortunately, this is also the final nail in the coffin of the \enquote{view source mentality} of the Web. Developers are more reliant on tooling than ever to understand complex web applications.
	
	\item Unlike previous attempts like ActiveX, Native Client~\citeTodo, or asm.js~\citeTodo, WebAssembly is truly portable across all major browsers, which is an impressive social achievement on top of the technical one. The multitude of actors makes it crucial to not rely on a single vendor for WebAssembly tooling support. If just because of their users, developers need to test on and work with any of the competing WebAssembly implementations.
	 
	\item WebAssembly's core use-case is as a compilation target for systems programming languages like C, C++, or Rust. The low-level control over memory layout and allocations, and the close mapping to native instructions enables much of its speed, but also comes with great responsibility. Developers on x86 are used to tools built on top of, e.g., Valgrind~\citeTodo{} or Pin~\citeTodo{} to find bugs or fix performance problems, but no dynamic analysis platform exists for WebAssembly so far.
\end{enumerate}
%new possibilities, but also new challenges:
%- (portable; good: works everywhere, bad: need tools in all of these browsers) Supported across all major browsers (Chrome, Firefox, Safari, Edge), on PCs and mobile devices
%- (binary; good: compact and fast, bad: no view source anymore, more low-level, less accessible -> we need tools more than ever!) While the binary format makes WebAssembly programs compact and quick to decode (unlike JavaScript, where parsing can take a substantial amount of the time to first meaningful interaction), it is also the final nail in the coffin for the "view source" mentality of the web.
%- Compilation target for systems languages like C, C++, and Rust; people are used to great analysis tools like Memcheck or UBSan, but currently there are no counterparts for this in Wasm

\noindent
In this paper, we present \emph{Wasabi}, a framework for \underline{W}eb\-\underline{As}sembly dynamic \underline{a}nalysis through \underline{b}inary \underline{i}nstrumentation. As every dynamic analysis framework, our design has to take decisions along several broad dimensions (which we explain in more detail in \Cref{sec:design}):

\begin{itemize}[leftmargin=\parindent, label=$\circ$]
	\item \emph{Heavyweight vs. lightweight}: Lightweight dynamic analysis (like TODO~\citeTodo) incurs minimal overhead, but does so at the cost of observing only a subset of the program execution, typically at the interface to the outside world, e.g., syscalls to the operating system or library function calls. On the other end of the spectrum stands full emulation (TODO~\citeTodo), which can observe any behavior. It is not only slow, but also very hard to implement correctly, i.e., such that the emulated behavior matches the real execution. We choose (binary) instrumentation, which hits a sweet spot between these extremes. No full Wasm VM has to be implemented or modified, while at the same time any single instruction of the program can be monitored.
	
	\item \emph{Static vs. dynamic instrumentation}: In x86, variable length instructions and self-modifying code make reliable static disassembly almost impossible, necessitating dynamic instrumentation in Valgrind~\citeTodo, DynamoRIO~\citeTodo, and Pin~\citeTodo. Thankfully, WebAssembly is well designed to be decoded and verified statically, allowing us to reliably instrument the whole program in one shot before execution. Though, for developer convenience Wasabi does not have to be run externally on Wasm files before execution. Simply adding a single file to your website or Node.js project is sufficient to transparently instrument all Wasm parts of an application.
	
	\item \emph{Interaction between application and analysis code}:
	modification/merging/inlining
	callbacks
	in which language should it be written	
	Jalangi~\cite{Sen:2013:JSR:2491411.2491447}
	
	possible (no double memory in Wasm)
	performance (no interop to pay)
	usability (JS for analyses is nice)
\end{itemize}

\noindent
We have made our choices in the design space to give Wasabi three key characteristics:

\begin{itemize}[leftmargin=\parindent, label=$\circ$]
	\item \emph{Powerful}: To the best of our knowledge, Wasabi is the first dynamic analysis framework for WebAssembly whatsoever. We think it is prudent to cover the general and powerful case first and only later focus on optimization and special cases.
	
	analyze any instruction, all inputs and results to instructions. i64. in practice: suffices to implement common analyses (coverage, profiling) as well as complex ones (memory checking, taint analysis).
	heavy weight, not lightweight
	
	\item \emph{Robust}: original program semantics are not changed, memory unaltered, reliable disassembly (thanks to great spec, not us...)
	
	\item \emph{Easy to use}: many analysis frameworks are intimidating to use, many options, lots of code necessary. abstract away 
	
\end{itemize}

Parts of Wasabi
static vs dynamic

Dynamic analyses on top of Wasabi
- coverage
- trace
- memory checker
- taint analysis

Contributions

%good: anything CPU and/or memory allocation intensive

%Wasm: new performant low-level/binary stack-based VM, client side web only had JavaScript and several not or no longer widely supported extensions such as ActiveX, Java, Flash, NaCl and PNaCl, asm.js.

%Dynamic Analysis: very generic term, powerful techniques fall into this category, used 

% Gap: What is missing, "the problem"
%True end of the "view-source" mentality (already severely limited with bundlers, minification, obfuscation)
%Very early: static analysis, like wasm explorer/wasm Studio, wasm code size profiler
%No dynamic wasm tooling at all (to the best of our knowledge)

% Innovation: What do we do and why does it solve the problem

%\paragraph{Name of the Tool}
%there are already 2 programs with name Wasabi, alternative: Wasambi?  sounds similar to Jalangi ;)
%
%make searchable: "wasabi toolkit"?
%
%domains: (wasambi|wasabi-toolkit|wasabi-framework).(de|com|org|eu) are free
%
%crates.io names are both free: wasabi and wasambi

\paragraph{Pros of our approach}
Some of the robustness of our approach can be attributed to the great design of WebAssembly (e.g., reliable disassembly, unlike for x86), but others have involved careful design of our approach (no memory modification) and necessitated solving unique challenges (monomorphization of instrumentation hooks)

Full coverage: every instruction can be observed

i64 handling

memory is never touched (\textrightarrow robustness), only instructions inserted are operating on stack/locals + calls

(TODO) could on-the-fly instrument by compiling instrumentation itself to WASM

no need to modify browser engine: works with every vendor, easier to maintain

\paragraph{Contributions}

- tooling is an "enabling technology" for many more applications: performance, security, correctness
- wasm is young, not tooling yet!
- first binary instrumentation framework for Wasm
- first dynamic analysis framework for Wasm whatsoever
- heavy-weight, but very powerful and generic (unlike TaintAssembly)
- see presentations:
	* Complete, powerful
	* Robust, correct
	* Easy-to-use
- technical: 
	* "on-demand monomorphization", we create only the variants that actually exist in the binary (compare with all possible combinations that we would otherwise have to create)
	* no memory changes
	* convenient, high-level API
		- mapping labels -> instruction locations
		- binary/unary hooks are generic over every instruction
		- different types handled, especially i64
- meta execution (but lets do it in javascript for now...)
		
\paragraph{Open Questions}
- how is multithreading in C/C++ actually compiled to Wasm?
	* it cant with stable: fails with "unresolved symbol pthreads"
	* on nightly: web workers + SAB + added WASM atomic load/store instructions

- how are we different from Jalangi?

\newpage
\section{Background}
\label{sec:background}

why Wasm is interesting

compilation target for languages on the client (a first since JS!)

new Ethereum VM bytecode

running example: WAST format, WASM bytecode

\newpage
\section{Design Space and Trade-Offs}
\label{sec:design}

streaming instrumentation

parallel instrumentation

static vs dynamic (JIT) instrumentation: dynamic not necessary since WASM can be reliably disassembled (unlike x86)

in-engine vs externally

instrumentation language: Rust -> WASM

analysis language: JS

\newpage
\section{Overview}
\label{sec:overview}

layered architecture

\newpage
\section{Implementation}
\label{sec:implementation}

\subsection{Using the \name{} Analysis API}

\subsection{Limitations}
- call\_indirect

- mapping labels -> locations

- drop/select

- mutations

\newpage
\section{Evaluation}

\subsection{Overhead}
code size

performance: SPEC CPU, Ostrich, vs. TaintAsm, SF4.0 "kernels"?

\subsection{Robustness}
compile wide range of benchmarks/test programs, see if they still work as before

\subsection{Usability and Applications}
Classical Dynamic Analysis Triplet: Correctness, Security, Performance
corresponding analyses to implement: memory checking tool (cf. Dr. Memory), taint analysis, profiling/coverage

case studies: tools/analyses written on top of \name

stmt, branch coverage

taint analysis

memory profiler, tracer

for security: reverse engineering WASM malware, especially important now that WASM takes away "view source" mentality of the web

idea: reverse engineer coinhive monero miner written in WASM

"enabling technology", e.g. Jalangi has been used in ... projects, cited ... times

\newpage
\section{Related Work}

\subsection{WebAssembly}

WebAssembly \cite{Haas:2017:BWU:3062341.3062363}

\subsection{Binary Instrumentation and Dynamic Analysis}

Jalangi \cite{Sen:2013:JSR:2491411.2491447}

PIN \cite{Luk:2005:PBC:1065010.1065034}

Valgrind \cite{Nethercote:2007:VFH:1250734.1250746}

TaintAssembly \cite{2018arXiv180201050F}

TaintDroid \cite{Enck:2014:TIT:2642648.2619091}

\bibliography{references}

\end{document}
